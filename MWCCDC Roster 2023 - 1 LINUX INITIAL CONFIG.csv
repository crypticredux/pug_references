,,,,NON-ROOT ADMIN USERNAMES,
,Visit every linux server/CLI machine and implement as much of this as possible,,,,
,Prep -- Get up to speed,,,,
,"Create 2 non-root, admin users in sudo group w/ long complicated passwords","[ adduser | useradd ] -m <USERNAME>     eg:   adduser -m hawkeye
usermod -aG <GROUP NAME> <USERNAME>     eg:    usermod -aG sudo hawkeye
//    PICK A PASSWORD FROM SHEET, LET TEAM KNOW ##     ",,,
,UPDATE SUDOERS TO INCL NEW GROUP !!!,visudo          OR          sudo vi /etc/sudoers    -->>>     %<GROUP NAME>        ALL : (ALL) ALL,,,
,VERIFY NEW USERS ARE IN SUDO GROUP(S) AND ARE ABLE TO LOG IN W/ SUDO PRIVS BEFORE CHANGING/DISABLING ROOT USER; RESTART THE MACHINE,"groups <USERNAME>
su - <username>
",,,
,Change default root password... this password might as well be long and unrecognizable,sudo passwd root                //    Probably still write it down somewhere,,,
,Configure SSH,"sudo nano /etc/ssh/sshd_config -->>> AllowTcpForwarding no, ClientAliveCountMax 2, ClientAliveInterval 60, Compression no, IgnoreRhosts yes, HostbasedAuthentication no, LogLevel VERBOSE, MaxAuthTries 3, MaxSessions 2, PermitEmptyPasswords no, PermitRootLogin no, PermitTunnel no, Port 4242, Protocol 2, TCPKeepAlive no, UseDNS no, UsePrivilegeSeparation sandbox, Ciphers aes128-ctr,aes192-ctr,aes256-ctr, X11Forwarding no",,,
,Restart SSH/SSHD service,ubuntu: sudo service ssh restart /// centos:  sudo systemctl restart sshd,,,
,Restart system,sudo reboot,,,
,,,,,
,TROUBLESHOOT NETWORK SETTINGS,,,,
,,,,,
,Update/Upgrade,sudo apt update; sudo apt upgrade,,,
,Setup unattended upgrades,sudo apt install unattended-upgrades; sudo apt install apt-listchanges; sudo dpkg-reconfigure --priority=low unattended-upgrades; -->>> sudo nano /etc/apt/apt.conf.d/50unattended-upgrades wq sudo nano /etc/apt/apt.conf.d/20auto-upgrades (sets upd freq in days) wq;,,,
,Restart system,,,,
,Disable root user,,,,
,Enable password complexity and age,"Debian/Ubuntu: sudo nano /etc/login.defs -->>> PASS_MAX_DAYS 1, PASS_MIN_DAYS 0, PASS_WARN_AGE 0  wq    sudo apt install libpam-pwquality  -->>> sudo nano /etc/pam.d/common-password  -->>> password requisite pam_pwquality.so retry=3 minlen=12 maxrepeat=2 ucredit=-1 lcredit=-1 dcredit=-1 ocredit=-1 difok=4 reject_username enforce_for_root    ---    CentOS/RHEL:  sudo vim /etc/pam.d/system-auth  -->>> password requisite pam_pwquality.so try_first_pass local_users_only retry=3 authok_type= minlen=12 lcredit=-1 ucredit=-1 ocredit=-1 enforce_for_root   wq",,"THOUGHTS ON:   Use chpasswd to increase SHA rounds needed to crack passwords BEFORE implementing new passwords for all users

sudo chpasswd -s 100000 -c SHA512 <<< username:password
",
,Check /etc/shadow file permissions. ,ls -l /etc/shadow,,,
,    Should be owned by root and in shadow group (set to 600 for non-world-readable),,,,
,Install AV,sudo apt install clamav ,,,
,Setup basic firewall (iptables or ufw?),sudo ufw status; sudo ufw default allow outgoing; sudo ufw default deny incoming; sudo ufw allow ssh; sudo ufw enable; sudo ufd allow 4224/tcp,,,
,"Randomize EVERY non-admin/root/sudo user's password, minimize permissions",,,,
,Setup 2FA?,"sudo apt install libpam-google-authenticator; sudo nano /etc/pam.d/sshd -->>> add line to top: ""auth required pam_google_authenticator.so"" wq -->>>sudo nano /etc/ssh/sshd_config -->>> ""ChallengeResponseAuthentication yes"" wq -->>> y to time-based tokens, y to update google auth file -->>> sudo service ssh restart",,,
,,,,,
,Install fail2ban,sudo apt install fail2ban; sudo service fail2ban status; sudo service fail2ban (start|stop|restart),,,
,Edit/configure fail2ban,"sudo nano /etc/fail2ban/jail.local; -->>> set default ban time to 48hrs, set ignoreip to ANY IP WE NEED TO ALLOW, set ignorself to true, sshd enabled = true ... wq -->>> sudo service fail2ban restart",,,
,,,,,
,^^^ Strong foundation.,^^^ Strong foundation.,,,
,Maintain -- Analyze,,,,
,Get user list & export to txt,awk -F: '{print $1}' /etc/passwd    Export to txt:   awk -F: '{print $1}' /etc/passwd > users.txt,,,
,Add/remove users,,last --since -2days,<-- last login,
,Add/remove groups,ADD:    sudo usermod -aG <GROUP> <USER>           REMOVE:       ,sudo lastb,<-- last BAD login,
,Check users in groups,sudo nano /etc/group,/var/log/auth.log,,
,Check sudoers to modify group sudo access,sudo nano /etc/sudoers,,,
,Modify read/write/execute access,chmod ### <USER>,,,
,Lock user account (lock root),sudo passwd -l [USER] (ex: sudo passwd -l grumby)     OR     sudo chage -E0 [USER]; sudo passwd -S [USER]    OR    sudo usermod --lock [USER]    or sudo usermod -L [USER],,,
,Check user account status,"grep [USER] /etc/shadow    ""!"" or ""!!"" will indicate locked    OR    sudo passwd --status [USER]     OR    sudo passwd -S [USER]",,,
,Unlock user account,sudo passwd -u [USER] (ex: sudo passwd -u grumby)    OR    sudo chage -E-1 [USER]    OR    sudo usermod --unlock [USER]    OR    sudo usermod -U [USER],,,
,Disable SSH access for user,sudo usermod -s /sbin/nologin [USER],,,
,Enagle SSH access for user,sudo usermod -s /bin/bash [USER],,,
,,,,,
,Shut down unnecessary network services,"Check: /etc/inetd.conf , /etc/xinetd.conf , and /etc/rc.d directories ... Is inetd/xinetd running? check: ps aux | grep (inetd|xinetd) ... which network services are being listened for?
grep –v ""^#"" /etc/inetd.conf or ls -l /etc/xinetd.d/* ... If inetd.conf is running, delete: talk, ntalk, finger, shell, login, ftp, telnet (any service you dont need)... replace ""root"" with ""nobody"" ... If xinetd is running, you need to edit the file for that particular service. For example, to turn off talk, you would edit the /etc/xinetd.d/talk file so that disable equals yes. Restart xinetd for any configuration changes to take effect. -- Some services are NOT found in inetd or xinetd. Enter:  cd /etc/rc.d   then   ls –l rc*.d    --- Upon startup, a Red Hat workstation installed with X-Windows defaults to runlevel 5; init looks in the /etc/rc.d/rc5.d directory and runs each start script it finds listed there. To identify the scripts that will run under a particular runlevel, such as 3, enter the following command:    cd rc3.d    then    ls -l    --- The partial listing of rc3.d does not contain the actual scripts themselves, but symbolic links to them which are located in the /etc/r.d/init.d directory. As with stand-alone systems connected to the Internet, the ps command should be executed upon booting your system to see which daemons have actually been started. If you don’t want a specific service to run, you must find and delete the link to its start script from its corresponding /etc/rc*.d directory.",,,
,,netstat --inet –a    AND    netstat --inet -a | grep LISTEN,,,
,,,,,
,,sudo iptables -L f2b-sshd --line-numbers,,,
,,,,,
,,,,,
,REGULARLY CHECK:,,,,
,"Services up/down, Users and access, rotate sudo user passwords, pspy, cron tabs/jobs",,,,
,,,,,
HOW TO...,,,,,
,BIG 10:,,,,
1,backup and restore critical system files modified maliciously,,,,
2,assess whether required services are online,,,,Determine what network services are currently running
3,modify user/group permissions,,,,
4,stop and restart services on demand,,,,Check fail2ban offenders
5,check who is logged into the machine,,,,
6,iptables essentials,,,,
7,"find common logs and parse w/ speed looking for ""out of the normal"" activity",,,,
8,push changes on one linux machine to any/all network linux machines,,,,
9,,,,,
10,,,,,
,,,,,
,"Linux: Disable RSH, Apache does NOT need root, enable ASLE, enable SELinux, remote APT package repo + key from /etc/hosts, disable database plugins and stored procedures where able",,,,
,,,,,
,,,,,
,,,,,
,Repair the Broken,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
CentOS,,,,,
,,,,,
,Ensure rsh server is not enabled,,,,
,systemctl disable rsh.socket,,,,
,systemctl disable rlogin.socket,,,,
,systemctl disable rexec.socket,,,,
,,,,,
,,,,,
,INSTALL SPLUNK RPM FILE,,,,
,Use wget URL,,,,
,Change the freaking filename for sanity purposes.,,,,
,Use: sudo rpm -i <FILE NAME>.rpm to install,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
RHEL,,,,,
,,,,,
,Disable RSH (remote shell),,,,
,/etc/xinetd.d/rsh and set disable = yes.,,,,
,After that restart xinetd,,,,
,,,,,
,"Disabling telnet for Unix systems running xinetd
To disable telnet, edit the file /etc/xinetd.d/telnet, and set the field labeled disable to yes.

Signal the xinetd daemon to reload its configuration by executing the commands

  cd /etc/rc.d/init.d
  ./xinted reload
Finally, verify that the xinetd reloaded properly by looking at the output of the system log file using the following command.
  tail -200 /var/log/messages",,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
"Configure NTP server (centos, red hat, fedora)",,,,,
,yum install ntp,,,,
,Nano/vi  /etc/ntp.conf,,,,
,Configure:,,,,
,restrict default kod nomodify notrap nopeer noquery,,,,
,restrict -6 default kod nomodify notrap nopeer noquery,,,,
,restrict 127.0.0.1,,,,
,restrict -6 ::1,,,,
,server 0.pool.ntp.org,,,,
,server 1.pool.ntp.org,,,,
,server 2.pool.ntp.org,,,,
,server 3.pool.ntp.org,,,,
,restrict 10.10.10.0 mask 255.255.255.0 nomodify notrap,,,,
,driftfile /var/lib/ntp/drift,,,,
,keys /etc/ntp/keys,,,,
,,,,,
,Start service,,,,
,service ntpd start,,,,
,or,,,,
,systemctl start ntpd.service,,,,
,,,,,
,,,,,
"Configure NTP client (centos, red hat, fedora)",,,,,
,yum install ntp,,,,
,Nano/vi  /etc/ntp.conf,,,,
,Configure:,,,,
,restrict default kod nomodify notrap nopeer noquery,,,,
,restrict -6 default kod nomodify notrap nopeer noquery,,,,
,restrict 127.0.0.1,,,,
,restrict -6 ::1,,,,
,server <NTP SERVER IP>,,,,
,driftfile /var/lib/ntp/drift,,,,
,keys /etc/ntp/keys,,,,
,,,,,
,Start service,,,,
,service ntpd start,,,,
,or,,,,
,systemctl start ntpd.service,,,,